# Deployment to Vercel (API + Client) and Firebase setup

This project uses Vercel to host both front-end (Vite/React) and server (Express endpoints under `/api`). Firestore is used as the database via `firebase-admin`.

## Environment variables (on Vercel)
Set these in your Vercel Project Settings -> Environment Variables for both Preview and Production as needed.

- FIREBASE_PROJECT_ID — your Firebase project ID
- FIREBASE_CLIENT_EMAIL — service account client_email from the JSON key
- FIREBASE_PRIVATE_KEY — the `private_key` from the service account JSON. IMPORTANT: when pasting into Vercel, replace literal newlines with `\n` (or paste as single-line). Example: `-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkq...\n-----END PRIVATE KEY-----\n`

Optional (if you use Firebase Admin features requiring a database URL):
- FIREBASE_DATABASE_URL — e.g. `https://<project-id>.firebaseio.com`

## Files touched by deployment
- `firebaseAdmin.js` — initializes Firebase Admin using the env vars above
- `api/*.js` — serverless endpoints that use `firebaseAdmin.js`
- `package.json` scripts — `build` and `dev` are already configured; Vercel will use these

## How Vercel will build
Vercel will run `npm run build` by default (see `package.json`). That runs Vite build and bundles the server with `esbuild` into `dist`.

Make sure `vercel.json` has `outputDirectory: "dist"` and `buildCommand: "npm run build"` (already present).

## Deploy steps (quick)
1. Commit & push your changes to GitHub (or connect repository to Vercel). Example:
   - git add -A; git commit -m "prepare vercel deploy"; git push origin main
2. In Vercel, import your Git repo and link the project.
3. In Project Settings -> Environment Variables, add the Firebase env vars listed above.
4. Trigger a deployment (Vercel will run `npm run build`). Watch the build logs for errors.

## Custom domain setup (Vercel)
1. In Vercel dashboard, go to your project -> Domains -> Add.
2. Enter your domain (e.g., example.com). Vercel will show DNS records.
3. At your domain registrar, add the required records (A/ALIAS or CNAME) as Vercel shows.
4. Once DNS propagates, Vercel will provision SSL automatically.

## Local development notes
- You can run locally with `npm run dev` (needs `tsx` to run `server/index.ts`).

Note: small harmless edit to this file to trigger a redeploy on Vercel.
- To test server endpoints locally, set local env vars (e.g., create `.env.local` or use your shell):
  - $env:FIREBASE_PROJECT_ID = "..."; $env:FIREBASE_CLIENT_EMAIL = "..."; $env:FIREBASE_PRIVATE_KEY = "...";

## Troubleshooting
- If build fails due to `firebase-admin` complaining about invalid credentials, double-check `FIREBASE_PRIVATE_KEY` line breaks and that `FIREBASE_CLIENT_EMAIL` matches the service account.
- If endpoints 401, ensure requests include an Authorization header `Bearer <id-token>` generated by Firebase client SDK.

